<div class="top-alert" [class.show]="showAlert" [ngClass]="{
       'alert-success': alertType === 'success',
       'alert-error': alertType === 'error',
       'alert-warning': alertType === 'warning'
     }">
  {{ alertMessage }}
</div>













<section *ngIf="byId" class="pre-order-section">



  <div *ngIf="isCheckingAuth" class="skeleton-wrap">
    <div class="skeleton-line"></div>
    <div class="skeleton-line"></div>
    <div class="skeleton-line"></div>
  </div>

  <!-- guest / not authenticated form -->
  <div *ngIf="!isCheckingAuth && !authenticated && !showCodeInput" class="input-container">


    <input type="tel" placeholder="ტელეფონი*" [(ngModel)]="phone" inputmode="numeric" pattern="[1-9]*"
      (keypress)="allowDigits($event)" (paste)="onPaste($event)" />

    <input type="text" placeholder="მიმღების სახელი და გვარი*" [(ngModel)]="recipientName">

    <input type="text" placeholder="ქალაქი*" [(ngModel)]="city">

    <input type="text" placeholder="მისამართი*" [(ngModel)]="address">

    <input type="text" placeholder="საფოსტო ინდექსი*" [(ngModel)]="postalCode">








    <button class="register-btn" (click)="verifyWhenNotAuthenticated()">გაგრძელება</button>
  </div>

  <!-- code input (shown after OTP start) -->
  <div *ngIf="!isCheckingAuth && !authenticated && showCodeInput" class="input-container">
    <p>შეიყვანეთ მიღებული კოდი</p>
    <input type="text" placeholder="კოდი" [(ngModel)]="otpCode" />
    <div style="display:flex;gap:10px;">
      <button class="register-btn" (click)="verifyOtpForCheckout()" [disabled]="isVerifying">
        {{ isVerifying ? 'მიმდინარეობს...' : 'დადასტურება' }}
      </button>
      <button class="register-btn" (click)="showCodeInput=false; challengeId = null; otpCode=''; errorMessage=null;"
        style="background:#ccc;color:#000;">
        გაუქმება
      </button>
    </div>
    <p *ngIf="errorMessage" style="color:#b00;margin-top:8px;">{{ errorMessage }}</p>
  </div>

  <!-- authenticated form -->
  <div *ngIf="!isCheckingAuth && authenticated && isPhone" class="input-container">
    <input type="text" placeholder="მიმღების სახელი და გვარი*" [(ngModel)]="recipientName">

    <input type="text" placeholder="ქალაქი*" [(ngModel)]="city">

    <input type="text" placeholder="მისამართი*" [(ngModel)]="address">

    <input type="text" placeholder="საფოსტო ინდექსი*" [(ngModel)]="postalCode">
    <button (click)="verifyWhenAuthenticated()" class="register-btn">გაგრძელება</button>
  </div>

</section>




<section *ngIf="existCartToken" class="pre-order-section">



  <div *ngIf="isCheckingAuth" class="skeleton-wrap">
    <div class="skeleton-line"></div>
    <div class="skeleton-line"></div>
    <div class="skeleton-line"></div>
  </div>

  <!-- guest / not authenticated form -->
  <div *ngIf="!isCheckingAuth && !authenticated && !showCodeInput && !isPhone " class="input-container">
    <input type="tel" placeholder="ტელეფონი*" [(ngModel)]="phone" inputmode="numeric" pattern="[1-9]*"
      (keypress)="allowDigits($event)" (paste)="onPaste($event)" />

    <input type="text" placeholder="მიმღების სახელი და გვარი*" [(ngModel)]="recipientName">

    <input type="text" placeholder="ქალაქი*" [(ngModel)]="city">

    <input type="text" placeholder="მისამართი*" [(ngModel)]="address">

    <input type="text" placeholder="საფოსტო ინდექსი*" [(ngModel)]="postalCode">
    <button class="register-btn" (click)="buyingFromCartNotRegistered()">გაგრძელება</button>
  </div>

  <!-- code input (shown after OTP start) -->
  <div *ngIf="!isCheckingAuth && !authenticated && showCodeInput" class="input-container">
    <p>შეიყვანეთ მიღებული კოდი</p>
    <input type="text" placeholder="კოდი" [(ngModel)]="otpCode" />
    <div style="display:flex;gap:10px;">
      <button class="register-btn" (click)="verifyOtpForCheckoutFromCart()" [disabled]="isVerifying">
        {{ isVerifying ? 'მიმდინარეობს...' : 'დადასტურება' }}
      </button>
      <button class="register-btn" (click)="showCodeInput=false; challengeId = null; otpCode=''; errorMessage=null;"
        style="background:#ccc;color:#000;">
        გაუქმება
      </button>
    </div>
    <p *ngIf="errorMessage" style="color:#b00;margin-top:8px;">{{ errorMessage }}</p>
  </div>

  <!-- authenticated form -->
  <div *ngIf="!isCheckingAuth && authenticated && isPhone" class="input-container">


    <input type="text" placeholder="მიმღების სახელი და გვარი*" [(ngModel)]="recipientName">

    <input type="text" placeholder="ქალაქი*" [(ngModel)]="city">

    <input type="text" placeholder="მისამართი*" [(ngModel)]="address">

    <input type="text" placeholder="საფოსტო ინდექსი*" [(ngModel)]="postalCode">
    <button (click)="buyingFromCartRegistered()" class="register-btn">გაგრძელება</button>
  </div>

</section>